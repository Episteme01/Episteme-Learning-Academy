<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Episteme Learning Academy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
    
        /* ====== SAME GLOBAL DESIGN AS PARENT DASHBOARD ====== */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .logout-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #2a5298;
            font-weight: bold;
        }
        
        .dashboard-wrapper {
            display: flex;
            min-height: 90vh;
        }
        
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .sidebar button {
            background: transparent;
            border: none;
            color: white;
            text-align: left;
            padding: 10px;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .sidebar button.active,
        .sidebar button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            margin-bottom: 10px;
        }
        
        button.primary-btn {
            background: white;
            color: #2a5298;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            border: none;
        }
    </style>
</head>

<body>
    
    <div class="header">
        <h2>Episteme Learning Academy - Admin</h2>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
    
    <div class="dashboard-wrapper">
        
        <!-- SIDEBAR -->
        <div class="sidebar">
            <button onclick="showSection('dashboard', this)">Dashboard</button>
            <button onclick="showSection('addStudent', this)">Add Student</button>
            <button onclick="showSection('studentListSection', this)">Manage Students</button>
            <button onclick="showSection('scheduleManager', this)">Manage Schedule</button>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
            
            <!-- DASHBOARD -->
            <div id="dashboard" class="section">
                <div class="card">
                    <div class="card">
    <h3>Statistics</h3>
    <p id="totalStudents"></p>
</div>
                    <h3>Admin Overview</h3>
                    <p>Welcome to the Episteme Learning Academy Control Panel.</p>
                    <p>Use the sidebar to manage students, results, and schedules.</p>
                </div>
            </div>
            
            <!-- ADD STUDENT -->
            <div id="addStudent" class="section" style="display:none;">
                <div class="card">
                    <h3>Add New Student</h3>
                    
                    <input type="text" id="studentID" placeholder="Student ID (ELA001)">
                    <input type="email" id="parentEmail" placeholder="Parent Email">
                    <input type="password" id="parentPassword" placeholder="Parent Password">
                    
                    <input type="text" id="studentName" placeholder="Student Name">
                    <input type="text" id="studentClass" placeholder="Class">
                    <input type="number" id="studentAge" placeholder="Age">
                    <input type="text" id="studentProgram" placeholder="Program">
                    
                    <input type="password" id="adminPassword" placeholder="Confirm Admin Password">
                    <h4>Term 1 Results</h4>
                    <input type="number" id="t1math" placeholder="Math">
                    <input type="number" id="t1english" placeholder="English">
                    <input type="number" id="t1science" placeholder="Science">
                    <textarea id="t1comment" placeholder="Teacher Comment"></textarea>
                    
                    <h4>Attendance & Fees</h4>
                    <input type="number" id="attendance" placeholder="Attendance %">
                    <input type="text" id="feeStatus" placeholder="Fee Status">
                    
                    <button class="primary-btn" onclick="addStudent()">Save Student</button>
                </div>
            </div>
            
            <!-- STUDENT LIST -->
            <div id="studentListSection" class="section" style="display:none;">
                <div class="card">
                    <h3>All Students</h3>
                    <div id="studentList"></div>
                </div>
            </div>
            
            <!-- SCHEDULE MANAGER -->
            <div id="scheduleManager" class="section" style="display:none;">
                <div class="card">
                    <h3>Manage Weekly Schedule</h3>
                    <input type="text" id="scheduleClass" placeholder="Class (e.g Grade1)">
                    <textarea id="scheduleJSON" rows="6" placeholder="Paste Schedule JSON Here"></textarea>
                    <button class="primary-btn" onclick="saveSchedule()">Save Schedule</button>
                </div>
            </div>
            
        </div>
    </div>
    
    <script type="module">
    
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import {
    getAuth,
    onAuthStateChanged,
    signOut,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDocs, collection, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC4psvU8WSR1QQQsRlZ8HkHO57Dznbb9TA",
    authDomain: "episteme-learning-academy.firebaseapp.com",
    projectId: "episteme-learning-academy",
    storageBucket: "episteme-learning-academy.firebasestorage.app",
    messagingSenderId: "476274489231",
    appId: "1:476274489231:web:fb67e5fde8a5d26328bdfa"
};
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.showSection = function(id, btn) {
    document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
    document.getElementById(id).style.display = "block";
    
    document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
    if (btn) btn.classList.add("active");
};
        
        onAuthStateChanged(auth, (user) => {
    if (!user) {
        window.location.href = "admin-login.html";
    }
});
        /* SECTION SWITCHING */
        
        /* ADD STUDENT */

window.addStudent = async function() {
    
    const studentID = document.getElementById("studentID").value;
    const parentEmail = document.getElementById("parentEmail").value;
    const parentPassword = document.getElementById("parentPassword").value;
    const adminPassword = document.getElementById("adminPassword").value;
    
    const adminUser = auth.currentUser;
    const adminEmail = adminUser.email;
    
    try {
        
        // 1️⃣ Create Parent Account
        const parentCredential = await createUserWithEmailAndPassword(
            auth,
            parentEmail,
            parentPassword
        );
        
        const parentUID = parentCredential.user.uid;
        
        // 2️⃣ Save student to Firestore
        await setDoc(doc(db, "Students", studentID), {
            studentID,
            parentUID,
            parentEmail,
            studentName: document.getElementById("studentName").value,
            studentClass: document.getElementById("studentClass").value,
            attendance: Number(document.getElementById("attendance").value),
            feeStatus: document.getElementById("feeStatus").value
        });
        
        // 3️⃣ Sign admin back in
        await signInWithEmailAndPassword(
            auth,
            adminEmail,
            adminPassword
        );
        
        alert("Parent account created and admin restored.");
        
        loadStudents();
        
    } catch (error) {
        alert(error.message);
    }
};
        
        /* LOAD STUDENTS */
       async function loadStudents() {
    const snapshot = await getDocs(collection(db, "Students"));
    const list = document.getElementById("studentList");
    list.innerHTML = "";
    
    snapshot.forEach((docSnap) => {
        const student = docSnap.data();
        
        list.innerHTML += `
        <div class="card">
            <p><strong>${student.studentName}</strong></p>
            <p>${student.studentClass}</p>
            <button onclick="exportPDF('${student.studentName}')">Export</button>
            <button onclick="deleteStudent('${docSnap.id}')">Delete</button>
        </div>
        `;
    });
}
        
        window.deleteStudent = async function(id) {
            await deleteDoc(doc(db, "Students", id));
            loadStudents();
        };
        
        /* SAVE SCHEDULE */
        window.saveSchedule = async function() {
            const grade = document.getElementById("scheduleClass").value;
            const scheduleData = JSON.parse(document.getElementById("scheduleJSON").value);
            
            await setDoc(doc(db, "Schedule", grade), { days: scheduleData });
            alert("Schedule Updated");
        };
        
        /* LOGOUT */
        window.logout = async function() {
            await signOut(auth);
            window.location.href = "admin-login.html";
        };
        
        loadStudents();
        
        
        async function loadAnalytics() {
    const snapshot = await getDocs(collection(db, "Students"));
    document.getElementById("totalStudents").innerText =
        "Total Students: " + snapshot.size;
}

loadAnalytics();

window.exportPDF = function(name) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.text("Student Report", 20, 20);
    pdf.text("Name: " + name, 20, 30);
    pdf.save(name + "_report.pdf");
};
        const loginForm = document.getElementById("loginForm");

if (loginForm) {
    loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        // login logic
    });
}
    </script>
    
</body>

</html>
