<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Episteme Learning Academy Blog</title>
<link rel="stylesheet" href="style.css">
<meta name="description" content="">
<meta property="og:title" content="">
<meta property="og:description" content="">
<meta property="og:image" content="">
<style>.blog-grid {
display: grid;
grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
gap: 25px;
margin-top: 30px;
}

.blog-card {
background: #fff;
border-radius: 12px;
overflow: hidden;
box-shadow: 0 6px 20px rgba(0,0,0,0.08);
transition: transform 0.3s ease, box-shadow 0.3s ease;
text-align: center;
}

.blog-card img {
width: 100%;
height: 180px;
object-fit: cover;
}

.blog-card h3 {
margin: 15px 0 10px;
color: #1f6b2d;
}

.blog-card p {
padding: 0 15px 15px;
font-size: 0.95rem;
}

.blog-card:hover {
transform: translateY(-5px);
box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}
/* ===============================
   FULL BLOG POST STYLING
================================ */

.read-more-btn {
  margin-bottom: 15px;
  padding: 8px 18px;
  border: none;
  background: #7a0019;
  color: white;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s ease;
}

.read-more-btn:hover {
  background: #5a0013;
}

.blog-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.6s ease, padding 0.3s ease;
}

.blog-content article {
  line-height: 1.8;
  padding-bottom: 20px;
}

.blog-content h4 {
  color: #1f6b2d;
  margin-top: 20px;
}

.blog-content ul {
  padding-left: 20px;
  margin: 10px 0;
}

.blog-content p {
  margin-bottom: 15px;
}

#categoryFilter button {
  transition: 0.3s ease;
}

#categoryFilter button:hover {
  transform: translateY(-2px);
}
</style>

</head>

<body>

<header class="header">
  <div class="container header-flex">
    <img src="images/episteme-logo.png" alt="Logo" class="logo-img">
    <h1>Episteme Learning Academy Blog</h1>
<p><a href="index.html">‚Üê Back to Main Website</a></p>
  </div>
</header>

<section class="section">
  <div class="container">
    <h2>Latest Posts</h2>
    <div id="categoryFilter" style="margin-bottom:20px; text-align:center;"></div>
   <div class="blog-grid" id="blogContainer"></div>
<div id="pagination"></div>
    </div>
  </div>
</section>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4psvU8WSR1QQQsRlZ8HkHO57Dznbb9TA",
  authDomain: "episteme-learning-academy.firebaseapp.com",
  projectId: "episteme-learning-academy",
  storageBucket: "episteme-learning-academy.firebasestorage.app",
  messagingSenderId: "476274489231",
  appId: "1:476274489231:web:fb67e5fde8a5d26328bdfa",
  measurementId: "G-PKPLKXMWSX",
  databaseURL: "https://episteme-learning-academy-default-rtdb.europe-west1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const container = document.getElementById("blogContainer");
const blogRef = ref(db, "blogs");

const POSTS_PER_PAGE = 6;

let currentPage = 1;
let allBlogs = [];
let filteredBlogs = [];
let selectedCategory = "All";

onValue(blogRef, (snapshot) => {
  const data = snapshot.val();
  if (!data) return;

  allBlogs = Object.entries(data).reverse();

  generateCategoryButtons();
  applyFilter();
});

function generateCategoryButtons() {
  const filterDiv = document.getElementById("categoryFilter");
  filterDiv.innerHTML = "";

  const categories = new Set(["All"]);

  allBlogs.forEach(([id, blog]) => {
    if (blog.category) categories.add(blog.category);
  });

  categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;

    btn.style.margin = "5px";
    btn.style.padding = "8px 15px";
    btn.style.borderRadius = "20px";
    btn.style.border = "none";
    btn.style.cursor = "pointer";

    btn.style.background =
      cat === selectedCategory ? "#1f6b2d" : "#ddd";
    btn.style.color =
      cat === selectedCategory ? "white" : "black";

    btn.onclick = () => {
      selectedCategory = cat;
      currentPage = 1;
      generateCategoryButtons();
      applyFilter();
    };

    filterDiv.appendChild(btn);
  });
}

function applyFilter() {
  if (selectedCategory === "All") {
    filteredBlogs = allBlogs;
  } else {
    filteredBlogs = allBlogs.filter(
      ([id, blog]) => blog.category === selectedCategory
    );
  }

  renderPage();
}

function renderPage() {
  container.innerHTML = "";

  const start = (currentPage - 1) * POSTS_PER_PAGE;
  const end = start + POSTS_PER_PAGE;

  const blogsToShow = filteredBlogs.slice(start, end);

  blogsToShow.forEach(([id, blog]) => {
    const card = document.createElement("div");
    card.className = "blog-card";

    card.innerHTML = `
      <img src="${blog.image || 'images/default.jpg'}" alt="${blog.title}">
      <h3>${blog.title}</h3>
      <p>${blog.excerpt}</p>
      <button class="read-more-btn">Read More</button>
      <div class="blog-content">
        <article>${blog.content}</article>
      </div>
    `;

    container.appendChild(card);

    const button = card.querySelector(".read-more-btn");
    const content = card.querySelector(".blog-content");

    button.addEventListener("click", async () => {

      if (content.style.maxHeight) {
        content.style.maxHeight = null;
        button.textContent = "Read More";
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
        button.textContent = "Show Less";

        await update(ref(db, "blogs/" + id), {
          views: (blog.views || 0) + 1
        });

        document.querySelector("meta[name='description']")
          ?.setAttribute("content", blog.excerpt);

        document.querySelector("meta[property='og:title']")
          ?.setAttribute("content", blog.title);

        document.querySelector("meta[property='og:description']")
          ?.setAttribute("content", blog.excerpt);

        document.querySelector("meta[property='og:image']")
          ?.setAttribute("content", blog.image);
      }

    });
  });

  renderPagination();
}

function renderPagination() {
  const totalPages = Math.ceil(filteredBlogs.length / POSTS_PER_PAGE);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.style.margin = "5px";
    btn.onclick = () => {
      currentPage = i;
      renderPage();
    };
    pagination.appendChild(btn);
  }
}

</script>
</body>
</html>
