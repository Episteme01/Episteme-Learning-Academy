<!DOCTYPE html>  <html>  
<head>  
    <title>Admin Login - Episteme Learning Academy</title> 
<link rel="stylesheet" href="admin.css">
</head>  
<body>  <h1>Admin Login</h1>  

<form id="adminLoginForm">
    <input type="email" id="adminEmail" placeholder="Admin Email" required><br><br>
    <input type="password" id="adminPassword" placeholder="Password" required><br><br>
    <button type="submit">Login</button>
</form>


<script>  
async function hashPassword(password) {  
const encoder = new TextEncoder();  
const data = encoder.encode(password);  
const hashBuffer = await crypto.subtle.digest("SHA-256", data);  
const hashArray = Array.from(new Uint8Array(hashBuffer));  
const hashHex = hashArray.map(b => b.toString(16).padStart(2, "0")).join("");  
return hashHex;

}

    function showReset() {  
document.getElementById("resetSection").style.display = "block";

}

async function resetPassword() {
const id = document.getElementById("resetID").value;
const newPassword = document.getElementById("newPassword").value;

if (newPassword.length < 5) {  
    document.getElementById("resetMessage").textContent = "Password must be at least 5 characters.";  
    return;  
}  
  
const hashedPassword = await hashPassword(newPassword);  
  
let students = JSON.parse(localStorage.getItem("students")) || [];  
  
const studentIndex = students.findIndex(s => s.studentID === id);  
  
if (studentIndex !== -1) {  
    students[studentIndex].parentPassword = hashedPassword;  
    localStorage.setItem("students", JSON.stringify(students));  
    document.getElementById("resetMessage").textContent = "Password reset successful!";  
    document.getElementById("resetMessage").textContent = "Student ID not found.";  
}

}
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
        getAuth,
        signInWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
        getFirestore,
        doc,
        getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyC4psvU8WSR1QQQsRlZ8HkHO57Dznbb9TA",
    authDomain: "episteme-learning-academy.firebaseapp.com",
    projectId: "episteme-learning-academy",
    storageBucket: "episteme-learning-academy.firebasestorage.app",
    messagingSenderId: "476274489231",
    appId: "1:476274489231:web:fb67e5fde8a5d26328bdfa"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // Handle Admin Login
    const loginForm = document.getElementById("adminLoginForm");
    
    if (loginForm) {
        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const email = document.getElementById("adminEmail").value.trim();
            const password = document.getElementById("adminPassword").value;
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                const adminRef = doc(db, "Admin", user.email);
                const adminSnap = await getDoc(adminRef);
                
                if (adminSnap.exists()) {
                    window.location.href = "admin.html";
                } else {
                    alert("Access denied. Not registered as admin.");
                }
                
            } catch (error) {
                alert("Login failed: " + error.message);
            }
        });
    }
</script>
</body>  
</html>
