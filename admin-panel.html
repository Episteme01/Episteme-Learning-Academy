<!DOCTYPE html>  <html>  
<head>  
    <title>Admin Login - Episteme Learning Academy</title> 
<link rel="stylesheet" href="admin.css">
</head>  
<body>  <h1>Admin Login</h1>  

<form id="adminLoginForm">
    <input type="email" id="adminEmail" placeholder="Admin Email" required><br><br>
    <input type="password" id="adminPassword" placeholder="Password" required><br><br>
    <button type="submit">Login</button>
</form>


<script>  
async function hashPassword(password) {  
const encoder = new TextEncoder();  
const data = encoder.encode(password);  
const hashBuffer = await crypto.subtle.digest("SHA-256", data);  
const hashArray = Array.from(new Uint8Array(hashBuffer));  
const hashHex = hashArray.map(b => b.toString(16).padStart(2, "0")).join("");  
return hashHex;

}

    function showReset() {  
document.getElementById("resetSection").style.display = "block";

}

async function resetPassword() {
const id = document.getElementById("resetID").value;
const newPassword = document.getElementById("newPassword").value;

if (newPassword.length < 5) {  
    document.getElementById("resetMessage").textContent = "Password must be at least 5 characters.";  
    return;  
}  
  
const hashedPassword = await hashPassword(newPassword);  
  
let students = JSON.parse(localStorage.getItem("students")) || [];  
  
const studentIndex = students.findIndex(s => s.studentID === id);  
  
if (studentIndex !== -1) {  
    students[studentIndex].parentPassword = hashedPassword;  
    localStorage.setItem("students", JSON.stringify(students));  
    document.getElementById("resetMessage").textContent = "Password reset successful!";  
    document.getElementById("resetMessage").textContent = "Student ID not found.";  
}

}
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyC4psvU8WSR1QQQsRlZ8HkHO57Dznbb9TA",
    authDomain: "episteme-learning-academy.firebaseapp.com",
    projectId: "episteme-learning-academy",
    storageBucket: "episteme-learning-academy.firebasestorage.app",
    messagingSenderId: "476274489231",
    appId: "1:476274489231:web:fb67e5fde8a5d26328bdfa",
    measurementId: "G-PKPLKXMWSX",
    databaseURL: "https://episteme-learning-academy-default-rtdb.europe-west1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

async function adminLogin(email, password) {
    try {
        const auth = getAuth();
        const db = getDatabase();
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Check if user is listed as an admin in Realtime DB
        const adminSnap = await get(ref(db, "admins/" + user.uid));
        if (adminSnap.exists()) {
            // Login successful
            window.location.href = "admin.html";
        } else {
            alert("Access denied: not an admin");
        }
        
    } catch (err) {
        console.error(err);
        alert("Login failed: " + err.message);
    }
}

// Attach this to your form submission
const loginForm = document.getElementById("adminLoginForm");
loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const email = document.getElementById("adminEmail").value.trim();
    const password = document.getElementById("adminPassword").value;
    adminLogin(email, password);
});
</script>
</body>  
</html>
